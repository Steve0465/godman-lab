version: '3.8'
services:
  app:
    build: .
    ports:
      - '8501:8501'
    environment:
      - OPENAI_ENABLED=${OPENAI_ENABLED}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - INPUT_DIR=/data/scans
      - OUTPUT_DIR=/data/receipts
      - METADATA_CSV=/data/receipts.csv
      - REVIEW_CSV=/data/review_queue.csv
      - SMTP_SERVER=${SMTP_SERVER}
      - SMTP_PORT=${SMTP_PORT}
      - EMAIL_USER=${EMAIL_USER}
      - EMAIL_PASS=${EMAIL_PASS}
      - RECIPIENT=${RECIPIENT}
    volumes:
      - ./:/app
      - ./scans:/data/scans
      - ./receipts:/data/receipts

  worker:
    build: .
    command: ["python","process_receipts.py"]
    environment:
      - OPENAI_ENABLED=${OPENAI_ENABLED}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    volumes:
      - ./:/app
      - ./scans:/data/scans
      - ./receipts:/data/receipts
